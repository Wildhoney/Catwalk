"use strict";!function(t){var e="__catwalk",n={NEW:1,DIRTY:2,SAVED:4,DELETED:8},i=function(){this.events={},this.collections={},this.relationship=new o};$traceurRuntime.createClass(i,{createCollection:function(t,e){var n=new r(t,e);return this.collections[t]=n,n},on:function(t,e){this.events[t]=e}},{});var r=function(t,e){this.id=0,this.name=t,this.models=[],this.silent=!1,this.blueprint=new s(e)};$traceurRuntime.createClass(r,{silently:function(t){this.silent=!0,t.apply(this),this.silent=!1},createModel:function(t){var e=this.blueprint.iterateAll(t);return this.injectMeta(e),Object.seal(e),this.models.push(e),this.issuePromise("create",e,null),e},updateModel:function(t,e){var n={};Object.keys(t).forEach(function(e){return n[e]=t[e]});try{Object.keys(e).forEach(function(n){return t[n]=e[n]})}catch(i){}return this.issuePromise("update",t,n),t},deleteModel:function(t){var n=this,i=function(t,e){n.issuePromise("delete",null,t),n.models.splice(e,1)};return function(){var e=n.models.indexOf(t);-1!==e&&i(n.models[e],e)}(),function(){var r=0;n.models.forEach(function(n){n[e].id===t[e].id&&i(n,r),r++})}(),t},injectMeta:function(t){t[e]={id:++this.id,status:n.NEW}},issuePromise:function(t,e,n){var i=this;this.silent||"function"==typeof catwalk.events[t]&&new Promise(function(r,s){catwalk.events[t](i.name,i.cleanModel(e||n),{resolve:r,reject:s})}).then(function(r){i.resolvePromise(t,e,n)(r)},function(r){i.rejectPromise(t,e,n)(r)})},resolvePromise:function(t,i,r){var s=this;return i&&"create"===t&&(i[e].status=n.SAVED),null===i&&r&&"delete"===t&&(r[e].status=n.DELETED),function(t){s.silently(function(){t&&s.updateModel(i,t)}),s.conditionallyEmitEvent()}},rejectPromise:function(t,i,r){var s=this,o=function(o){o&&s.silently(function(){"update"===t&&o.hasOwnProperty(e)&&(s.deleteModel(r),r[e].status=n.DELETED),s.updateModel(i,o),i[e].status=n.SAVED}),s.conditionallyEmitEvent()};return null===r&&"create"===t?(this.silently(function(){s.deleteModel(i),i[e].status=n.DELETED}),o):(null===i&&"delete"===t&&this.silently(function(){var t=s.updateModel({},r);s.models.push(t)}),i&&r&&"update"===t?(this.silently(function(){s.updateModel(i,r)}),o):o)},conditionallyEmitEvent:function(){"function"==typeof catwalk.events.refresh&&catwalk.events.refresh()},cleanModel:function(t){var n={};return Object.keys(t).forEach(function(i){i!==e&&(n[i]=t[i])}),n}},{});var s=function(t){this.model=Object.freeze(t)};$traceurRuntime.createClass(s,{iterateAll:function(t){var e=this.iterateProperties(t);return this.iterateBlueprint(e)},iterateProperties:function(t){var e=this,n={};return Object.keys(t).forEach(function(i){var r=t[i],s=e.model[i];"undefined"!=typeof s&&("function"==typeof s&&(r=s(r)),n[i]=r)}),n},iterateBlueprint:function(t){var e=this;return Object.keys(this.model).forEach(function(n){if("function"==typeof t[n])try{throw void 0}catch(i){return i=e.model[n],void(t[n]=i())}"undefined"==typeof t[n]&&(t[n]=null)}),t}},{});var o=function(){};$traceurRuntime.createClass(o,{hasOne:function(t,e){return new l(t,e)},hasMany:function(t,e){return new a(t,e)}},{});var u=function(t,e){this.foreignKey=t,this.collectionName=e};$traceurRuntime.createClass(u,{},{});var a=function(){$traceurRuntime.defaultSuperCall(this,c.prototype,arguments)},c=a;$traceurRuntime.createClass(a,{},{},u);var l=function(){$traceurRuntime.defaultSuperCall(this,f.prototype,arguments)},f=l;$traceurRuntime.createClass(l,{},{},u),t.catwalk=new i}(window);