/*! catwalk.js by Adam Timberlake created on 2013-12-09 */
!function(a){"use strict";a.catwalk={}}(window),function(a){"use strict";var b=function(a){return String(a)},c=function(a){return Number(a)},d=function(a){return Number(a)},e=function(a){return Boolean(a)};a.catwalk.attribute={string:b,integer:c,"float":d,"boolean":e}}(window),function(a){"use strict";var b={},c=function(a,b){this._crossfilter={},this._dimensions={},this._name=a,this._properties=b;var c=this._crossfilter=crossfilter([]),d=this._dimensions,e=_.keys(b);_.forEach(e,function(a){"_"!==a.charAt(0)&&(d[a]=c.dimension(function(b){return b[a]}))}),d.catwalkId=c.dimension(function(a){return a._catwalkId})};c.prototype={_name:"",_events:{create:function(a){console.info("Created "+a.length+" model(s): "+_.pluck(a,"id"))},read:function(){},update:function(){},"delete":function(){}},_properties:{},_crossfilter:{},_dimensions:{},addModel:function(a){return this.addModels([a])[0]},addModels:function(a){var b=[],c=this._properties,d=this._properties._relationships||{},e=_.bind(this._createRelationship,this);_.forEach(a,function(a){a._catwalkId=_.uniqueId("catwalk_")}),a.forEach(function(a){_.forEach(a,function(b,f){if("_catwalkId"!==f){if("function"==typeof d[f])return e(a,f,b),void 0;try{a[f]=c[f](b)}catch(g){throw"You forgot to define the `"+f+"` property on the collection blueprint."}}}),b.push(a)}),this._crossfilter.add(b);var f=this._properties._primaryKey,g=_.pluck(a,"id"),h=this._dimensions[f].filterAll().filterFunction(function(a){return!!_.contains(g,a)});return this._events.create(a),h.top(1/0)},when:function(a,b){this._events[a]=b},removeModel:function(a){if(!("_catwalkId"in a))throw"You are attempting to remove a non-Catwalk model.";this._dimensions.catwalkId.filterFunction(function(b){return b!==a._catwalkId}),this._events.delete(a)},all:function(){return this._dimensions[this._properties._primaryKey].filterAll().top(1/0)},size:function(){return this._crossfilter.size()},_createRelationship:function(a,b,c){var d=this._properties._relationships||{};Object.defineProperty(a,b,{get:function(){return d[b](c)}})}},a.collection=function(a,d){return d?(b[a]=new c(a,d),b[a]):b[a]}}(window.catwalk),function(a,b){"use strict";var c=function(a){return function(c){var d=b.collection(a.collection),e=d._dimensions[a.foreignKey],f=e.filterAll().filterFunction(function(a){return c===a}).top(1/0)||[];if(0===f.length){var g=Q.defer();d._events.read(c,g),g.promise.then(function(a){a=d.addModel(a),f.push(a),console.log(f)})}return f[0]}},d=function(a){return function(c){var d=b.collection(a.collection),e=d._dimensions[a.foreignKey],f=e.filterAll().filterFunction(function(a){return!!_.contains(c,a)}).top(1/0);if(c.length!==f.length){var g=Q.defer(),h=_.difference(c,_.pluck(f,"id"));d._events.read(h,g),g.promise.then(function(a){var b=d.addModels(a);a=a.concat(b),console.log(a)})}return f}};a.catwalk.relationship={hasOne:c,hasMany:d,belongsTo:function(){},hasAndBelongsToMany:function(){}}}(window,window.catwalk);